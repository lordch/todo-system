<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miejsca - Mapa</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #map {
            flex: 1;
            width: 100%;
        }

        .sidebar {
            position: absolute;
            top: 0;
            left: 0;
            width: 320px;
            max-height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .sidebar h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            font-weight: 600;
        }

        .place-item {
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .place-item:hover {
            background: #f5f5f5;
            border-color: #007bff;
            transform: translateX(4px);
        }

        .place-item.active {
            border-color: #007bff;
            background: #e7f3ff;
        }

        .place-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .place-address {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }

        .place-type {
            display: inline-block;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            background: #e9ecef;
            color: #495057;
            font-weight: 500;
            text-transform: uppercase;
        }

        .place-type.dom { background: #d4edda; color: #155724; }
        .place-type.mieszkanie { background: #d1ecf1; color: #0c5460; }
        .place-type.praca { background: #fff3cd; color: #856404; }
        .place-type.szkola { background: #f8d7da; color: #721c24; }
        .place-type.pralnia { background: #e2e3e5; color: #383d41; }
        .place-type.sklep { background: #d4edda; color: #155724; }

        .mapboxgl-popup-content {
            padding: 15px;
            border-radius: 8px;
        }

        .mapboxgl-popup-content h3 {
            margin-bottom: 8px;
            color: #333;
        }

        .mapboxgl-popup-content p {
            margin: 4px 0;
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                max-height: 40vh;
                position: relative;
            }

            #map {
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>üìç Miejsca</h1>
        <div id="places-list"></div>
    </div>
    <div id="map"></div>

    <script>
        // UWAGA: ZastƒÖp poni≈ºszy token w≈Çasnym tokenem Mapbox
        // Pobierz token na: https://account.mapbox.com/access-tokens/
        // Dla test√≥w mo≈ºesz u≈ºyƒá publicznego tokenu, ale dla produkcji u≈ºyj w≈Çasnego
        mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNvZ2J5bW4ydjAwNHIyd3BqMDZ6b2EifQ.CBx7J6tYfRpVYOMsVgBJSQ';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [21.0, 52.21],
            zoom: 12
        });

        function getColorForType(typ) {
            const colors = {
                'dom': '#28a745',
                'mieszkanie': '#17a2b8',
                'praca': '#ffc107',
                'szko≈Ça': '#dc3545',
                'pralnia': '#6c757d',
                'sklep': '#28a745'
            };
            return colors[typ] || '#007bff';
        }

        // Funkcja do inicjalizacji mapy z danymi
        function initMap(miejscaData) {
            const miejsca = miejscaData;
            const placesList = document.getElementById('places-list');
            const markers = [];

            // Funkcja dodajƒÖca markery
            function addMarkers() {
                miejsca.miejsca.forEach((miejsce, index) => {
                    const el = document.createElement('div');
                    el.className = 'marker';
                    el.style.width = '30px';
                    el.style.height = '30px';
                    el.style.borderRadius = '50%';
                    el.style.background = getColorForType(miejsce.typ);
                    el.style.border = '3px solid white';
                    el.style.cursor = 'pointer';
                    el.style.boxShadow = '0 2px 8px rgba(0,0,0,0.3)';

                    const marker = new mapboxgl.Marker(el)
                        .setLngLat([miejsce.koordynaty.lng, miejsce.koordynaty.lat])
                        .setPopup(new mapboxgl.Popup({ offset: 25 })
                            .setHTML(`
                                <h3>${miejsce.nazwa}</h3>
                                <p><strong>${miejsce.adres}</strong></p>
                                <p>${miejsce.opis}</p>
                            `))
                        .addTo(map);

                    markers.push(marker);

                    const placeItem = document.createElement('div');
                    placeItem.className = 'place-item';
                    placeItem.innerHTML = `
                        <div class="place-name">${miejsce.nazwa}</div>
                        <div class="place-address">${miejsce.adres}</div>
                        <span class="place-type ${miejsce.typ}">${miejsce.typ}</span>
                    `;

                    placeItem.addEventListener('click', () => {
                        map.flyTo({
                            center: [miejsce.koordynaty.lng, miejsce.koordynaty.lat],
                            zoom: 15,
                            duration: 1000
                        });
                        marker.togglePopup();
                        
                        document.querySelectorAll('.place-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        placeItem.classList.add('active');
                    });

                    placesList.appendChild(placeItem);
                });
            }

            // Sprawd≈∫ czy mapa jest ju≈º za≈Çadowana
            if (map.loaded()) {
                addMarkers();
            } else {
                map.on('load', () => {
                    addMarkers();
                });
            }
        }

        // Pr√≥ba wczytania danych z pliku JSON
        fetch('miejsca.json')
            .then(response => response.json())
            .then(data => {
                initMap(data);
            })
            .catch(error => {
                console.warn('Nie uda≈Ço siƒô wczytaƒá miejsca.json, u≈ºywam danych domy≈õlnych:', error);
                // Dane domy≈õlne jako fallback
                const defaultData = {
                    "miejsca": [
                        {
                            "id": "dom",
                            "nazwa": "Dom",
                            "adres": "Narbutta 45, 02-536 Warszawa, Polska",
                            "typ": "dom",
                            "opis": "Dom na Narbutta 45",
                            "koordynaty": {"lat": 52.2105, "lng": 21.0122}
                        },
                        {
                            "id": "pegaz",
                            "nazwa": "Pegaz",
                            "adres": "Grojecka 77, 02-301 Warszawa, Polska",
                            "typ": "mieszkanie",
                            "opis": "Mieszkanie Pegaza na Grojeckiej 77",
                            "koordynaty": {"lat": 52.2008, "lng": 20.9789}
                        },
                        {
                            "id": "pwc",
                            "nazwa": "PwC",
                            "adres": "Polna 11, 00-724 Warszawa, Polska",
                            "typ": "praca",
                            "opis": "Biuro PwC na Polnej 11",
                            "koordynaty": {"lat": 52.2296, "lng": 21.0122}
                        },
                        {
                            "id": "szkola-mikiego",
                            "nazwa": "Szko≈Ça Mikiego",
                            "adres": "Bruna 11, 02-594 Warszawa, Polska",
                            "typ": "szko≈Ça",
                            "opis": "Szko≈Ça Mikiego na Bruna 11",
                            "koordynaty": {"lat": 52.2044, "lng": 21.0011}
                        },
                        {
                            "id": "pralnia-posciel",
                            "nazwa": "Pralnia po≈õciel",
                            "adres": "Kwiatowa, Warszawa, Polska",
                            "typ": "pralnia",
                            "opis": "Pralnia na Kwiatowej - gdzie zanie≈õƒá po≈õciel",
                            "koordynaty": {"lat": 52.2150, "lng": 21.0050}
                        },
                        {
                            "id": "pralnia-narzuta",
                            "nazwa": "Pralnia narzuta Pegaza",
                            "adres": "Hala Banacha, Warszawa, Polska",
                            "typ": "pralnia",
                            "opis": "Pralnia przy hali Banacha - narzuta z mieszkania Pegaza",
                            "koordynaty": {"lat": 52.1989, "lng": 20.9567}
                        },
                        {
                            "id": "sklep-paczki",
                            "nazwa": "Sklep odbi√≥r paczki",
                            "adres": "Narbutta 45, 02-536 Warszawa, Polska",
                            "typ": "sklep",
                            "opis": "Sklep odbi√≥r paczki pod domem",
                            "koordynaty": {"lat": 52.2105, "lng": 21.0122}
                        },
                        {
                            "id": "sklep-kwiatki",
                            "nazwa": "Sklep z kwiatkami",
                            "adres": "Narbutta, Warszawa, Polska",
                            "typ": "sklep",
                            "opis": "Sklep z kwiatkami na Narbutta",
                            "koordynaty": {"lat": 52.2100, "lng": 21.0100}
                        }
                    ]
                };
                initMap(defaultData);
            });
    </script>
</body>
</html>
